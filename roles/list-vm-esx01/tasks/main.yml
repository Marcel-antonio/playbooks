# tasks file for list-vm-esx01
- name: Récupérer la liste des VMs (connexion API ESXi/vCenter)
  community.vmware.vmware_vm_info:
    hostname: "{{ esxi_hostname }}"
    username: "{{ esxi_username }}"
    password: "{{ esxi_password }}"
    validate_certs: "{{ esxi_validate_certs | default(false) }}"
  no_log: true
  register: vm_info

- name: Afficher les VMs (nom, power_state, guest_fullname, ip)
  ansible.builtin.debug:
    msg: >-
      {{ item.guest_name }} | {{ item.power_state }} | {{ item.guest_fullname | default('n/a') }} | {{ item.ip_address | default('n/a') }}
  loop: "{{ vm_info.virtual_machines | default([]) }}"

